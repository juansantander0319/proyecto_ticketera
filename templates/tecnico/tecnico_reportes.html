{% extends "base.html" %}

{% block title %}Reportes y Estadísticas - Ticketera{% endblock %}

{% block content %}
<div class="container-fluid fade-in">
  <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2 class="mt-4"><i class="bi bi-bar-chart"></i> Reportes y Estadísticas</h2>
        <p class="text-muted">Análisis del rendimiento y la carga de trabajo del sistema.</p>
      </div>
      <div>
          <a href="{{ url_for('exportar_reporte') }}" class="btn btn-success">
              <i class="bi bi-file-earmark-excel-fill"></i> Descargar Reporte Excel
          </a>
      </div>
  </div>

  <div class="row mt-3">
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white"><i class="bi bi-person-check"></i> Tickets Resueltos por Técnico</div>
        <div class="card-body"><canvas id="chartPorTecnico"></canvas></div>
      </div>
    </div>
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white"><i class="bi bi-tags"></i> Tickets por Categoría</div>
        <div class="card-body"><canvas id="chartPorCategoria"></canvas></div>
      </div>
    </div>
    <div class="col-md-12 mb-4">
      <div class="card shadow-sm">
        <div class="card-header bg-dark text-white"><i class="bi bi-pie-chart"></i> Resumen de Tickets por Estado</div>
        <div class="card-body" style="max-height: 400px; display: flex; justify-content: center;">
          <canvas id="chartPorEstado"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const chartData = {{ chart_data|tojson }};

    new Chart(document.getElementById('chartPorTecnico'), {
        type: 'bar',
        data: {
            labels: chartData.tecnicos_labels,
            datasets: [{
                label: 'Tickets Resueltos',
                data: chartData.tecnicos_data,
                backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1']
            }]
        }
    });

    new Chart(document.getElementById('chartPorCategoria'), {
        type: 'bar',
        data: {
            labels: chartData.categorias_labels,
            datasets: [{
                label: 'Cantidad de Tickets',
                data: chartData.categorias_data,
                backgroundColor: ['#6f42c1', '#fd7e14', '#20c997', '#0dcaf0', '#ffc107']
            }]
        }
    });

    new Chart(document.getElementById('chartPorEstado'), {
        type: 'doughnut',
        data: {
            labels: chartData.estados_labels,
            datasets: [{
                label: 'Tickets',
                data: chartData.estados_data,
                backgroundColor: ['#dc3545', '#ffc107', '#198754']
            }]
        }
    });
});
</script>
{% endblock %}